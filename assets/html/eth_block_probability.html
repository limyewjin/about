<!DOCTYPE html>
<html>
<head>
  <title>Probability of Not Proposing a Block</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div>
    <label for="validators">Number of Validators (V):</label>
    <input type="number" id="validators" value="1">
  </div>
  <div>
    <label for="totalValidators">Total Validators in the Network (N):</label>
    <input type="number" id="totalValidators" value="1004957">
    <span style="font-size: 12px; color: gray;">(Last updated: 2024-05-22 10:15)</span>
  </div>
  <div>
    <label for="days">Number of Days:</label>
    <input type="number" id="days" value="30">
  </div>
  <button onclick="plotProbability()">Plot Probability</button>
  <canvas id="probabilityChart"></canvas>
  See <a href="https://yewjin.com/blog/2024/eth-validator-block-probability/">Blog post about these estimates</a>

  <script>
    let chart;

    function plotProbability() {
      const V = parseInt(document.getElementById('validators').value);
      const N = parseInt(document.getElementById('totalValidators').value);
      const days = parseInt(document.getElementById('days').value);

      const timeUnits = [];
      for (let i = 1; i <= days; i++) {
        timeUnits.push({ label: `Day ${i}`, slots: i * 7200 });
      }

      const probabilities = timeUnits.map(unit => Math.pow(1 - (V / N), unit.slots));

      const ctx = document.getElementById('probabilityChart').getContext('2d');

      if (chart) {
        chart.destroy();
      }

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timeUnits.map(unit => unit.label),
          datasets: [{
            label: 'Probability of Not Proposing a Block',
            data: probabilities,
            borderColor: 'blue',
            fill: false
          }]
        },
        options: {
          responsive: true,
          title: {
            display: true,
            text: 'Probability of Not Proposing a Block'
          },
          scales: {
            x: {
              title: {
                display: true,
                text: 'Time (Days)'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Probability'
              },
              ticks: {
                callback: function(value) {
                  return (value * 100).toFixed(2) + '%';
                }
              }
            }
          },
          tooltips: {
            callbacks: {
              label: function(tooltipItem, data) {
                const probability = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                const percentage = (probability * 100).toFixed(2);
                return `Probability: ${percentage}%`;
              }
            }
          }
        }
      });
    }

    // Render the plot on page load with 1 validator
    window.onload = function() {
      plotProbability();
    };
  </script>
</body>
</html>
