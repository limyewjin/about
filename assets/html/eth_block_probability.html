<!DOCTYPE html>
<html>
<head>
  <title>Probability of Not Proposing a Block</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h1>Probability of Not Proposing a Block</h1>
  <label for="eth">Your ETH Staked:</label>
  <input type="number" id="eth" min="1" value="32">
  <br>
  <label for="totalEligibleEther">Total Eligible Ether:</label>
  <input type="number" id="totalEligibleEther" min="1" value="32561145">
  <span style="font-size: 12px; color: gray;">(Last updated: 2024-06-07 10:15)</span>
  <br>
  <label for="days">Number of Days:</label>
  <input type="number" id="days" min="1" value="30">
  <br>
  <button onclick="plotProbability()">Plot Probability</button>
  <br>
  <canvas id="probabilityChart"></canvas>

  <script>
    let chart;

    function plotProbability() {
      const ethAmount = parseInt(document.getElementById('eth').value);
      const totalEligibleEther = parseInt(document.getElementById('totalEligibleEther').value);
      const days = parseInt(document.getElementById('days').value);

      const V = ethAmount;
      const N = totalEligibleEther;

      const timeUnits = [];
      for (let i = 1; i <= days; i++) {
        timeUnits.push({ label: `Day ${i}`, slots: i * 7200 });
      }

      const probabilities = timeUnits.map(unit => Math.pow(1 - (V / N), unit.slots));

      const ctx = document.getElementById('probabilityChart').getContext('2d');

      if (chart) {
        chart.destroy();
      }

      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: timeUnits.map(unit => unit.label),
          datasets: [{
            label: 'Probability of Not Proposing a Block',
            data: probabilities,
            borderColor: 'blue',
            fill: false
          }]
        },
        options: {
          responsive: true,
          title: {
            display: true,
            text: 'Probability of Not Proposing a Block'
          },
          scales: {
            x: {
              title: {
                display: true,
                text: 'Time (Days)'
              }
            },
            y: {
              title: {
                display: true,
                text: 'Probability'
              },
              ticks: {
                callback: function(value) {
                  return (value * 100).toFixed(2) + '%';
                }
              }
            }
          },
          tooltips: {
            callbacks: {
              label: function(tooltipItem, data) {
                const probability = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                const percentage = (probability * 100).toFixed(2);
                return `Probability: ${percentage}%`;
              }
            }
          }
        }
      });
    }

    // Render the plot on page load with 32 ETH
    window.onload = function() {
      plotProbability();
    };
  </script>
  <p>See accompanying <a href="https://yewjin.com/blog/2024/eth-validator-block-probability/">blog post</a></p>
</body>
</html>